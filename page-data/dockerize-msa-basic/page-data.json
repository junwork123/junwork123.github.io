{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/dockerize-msa-basic/",
    "result": {"data":{"cur":{"id":"d2193d58-d5ff-5f1b-80b5-ce33ce0ade1e","html":"<p>지적과 댓글은 언제나 환영합니다!</p>\n<br>\n<hr>\n<h2 id=\"들어가기에-앞서\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%97%90-%EC%95%9E%EC%84%9C\" aria-label=\"들어가기에 앞서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가기에 앞서..</h2>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">본 게시글은 MSA 형태로 구성된 서비스를 \n하나씩 도커라이징(dockerizing)하는 게시물입니다.\n\n도커 명령어를 배우는 초심자 입장에서 작성한 글로\n삽질했던 시간 순서대로 작성하였습니다.\n\n중급자 이상 분들은 필요한 명령어만 골라서 사용하시면 됩니다.</code></pre></div>\n<br>\n<hr>\n<br>\n<h2 id=\"현재-상황\" style=\"position:relative;\"><a href=\"#%ED%98%84%EC%9E%AC-%EC%83%81%ED%99%A9\" aria-label=\"현재 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>현재 상황</h2>\n<p>현재 가지고 있는 MSA 형태의 어플리케이션의 구조는 아래와 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACf0lEQVQoz22Sy09TQRSH+6/4v7gyJorGnRFNDEskutBERBGjxI1gdQGEiFHBBykg7/JGKPRFS6EiLfRBW/ru7W2hpb2PT9tb0IW/ZOaczJz5zpyZo0tFDzH2dOCcGaUiVVFQVVXzVfXMD4fC7Pg2OC7mqAVWpqr9N17nGhtAf/sKC+MaUFEUZFUbkiJXbUWvX7bzpKOBeNKDtGclYZsgYZ8m6zSiZA9RToHNX0ycuz/Izb41VEXifwpG4+i7ehiamgO5RMmzSnh9HO/SMPmtORDCtUgV3fxOlFH7Psl0proUKwpMxTcwJpxMxOzYsnsUikUcDgexeLR6SHLPkFgxsG38juocRoxH2IwUSOVL6KqQRA4VrbSvhz84v9JCnaWdC2tt3LB1IspHBCNHuPxH7HsC5L49ROy/hzDwgGJ/I0HLLC9mE1h8WQ3o8GZx+bL4gid0bs9St/yUa9NtXJ56TIPjDYKco5JPKKikwwfkB5sJ9Dax29VI8n0Ti+NGno36sPsFDSjJCmKhhFSE7r05LprauLrQxqXFVurNb9lLpzg+lsmXQIxFSAw8IvqukYPeOxx/asK1MMnzyRA2n4Du9MurLQDMJBxc33jFLXM39Q49d9f72fCm+OnPsu0X2dyJETDoyRlaiQ62I4+0cOAyo19O4gyK2g0rUKUGDhVSjEXMfHCu8dW7iklwnyXTJEHQSsQ2z65pkZNfS5RzKcQTlbKkaMBq/9WArlyAPo+RLouBLusQw+F18uVilVn5NqWQp7A1i3/+M7vTH8lYRlBTgb9tcwo8LT1azGARvFjTXixpD1tikLIinz2KKpWQYx7KYTcnITdyxI1ylNH2/jT2b6+3Db80o/CtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"msa\"\n        title=\"msa\"\n        src=\"/static/c4fef21cd9c5f1b37ad7342abc8dbf37/37523/msa.png\"\n        srcset=\"/static/c4fef21cd9c5f1b37ad7342abc8dbf37/e9ff0/msa.png 180w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/f21e7/msa.png 360w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/37523/msa.png 720w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/302a4/msa.png 1080w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/5d942/msa.png 1343w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>서비스 별로 실행파일이 분리가 되어</p>\n<p>API 요청으로 통신하고 있긴 하지만,</p>\n<p>실행 시, 같은 디렉토리 내에서 상대위치 참조를 하고 있다.</p>\n<p>즉, <u>물리적으로 분리가 어려운 상태</u>이다.</p>\n<br>\n<p>따라서, 단계적, 점진적으로 도커라이징하고자 한다.</p>\n<br>\n<h2 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h2>\n<p>이번 글에서는 <code class=\"language-text\">최소한의 분리</code>를 하려고 한다.</p>\n<ul>\n<li>\n<p>어플리케이션(MSA를 통째로) 과 DB를 각각 컨테이너화</p>\n</li>\n<li>\n<p>어플리케이션과 DB가 각각 다른 볼륨(Volume)을 가짐</p>\n</li>\n<li>\n<p>같은 내부 네트워크로 연결</p>\n</li>\n</ul>\n<br>\n</aside>\n<h2 id=\"여정\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EC%A0%95\" aria-label=\"여정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여정</h2>\n<ol>\n<li>\n<p>이미지 검색</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 도커 이미지 검색 - 다운로드 - 확인</span>\n<span class=\"token function\">docker</span> search ubuntu\n\n<span class=\"token function\">docker</span> pull ubuntu:18.04\n\n<span class=\"token function\">docker</span> images</code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"2\">\n<li>\n<p>컨테이너 생성 및 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 컨테이너끼리 묶을 네트워크 생성</span>\n<span class=\"token function\">docker</span> network create <span class=\"token variable\">${네트워크 이름}</span>\n\n<span class=\"token comment\"># 컨테이너 생성 및 실행</span>\n<span class=\"token comment\"># 로컬 포트랑 겹치면 하나만 실행할 수 있으므로 주의</span>\n<span class=\"token function\">docker</span> run -i -t --network <span class=\"token variable\">${네트워크 이름}</span> -p <span class=\"token number\">8080</span>:8080 -v D:<span class=\"token punctuation\">\\</span>repo:/data --name <span class=\"token variable\">${컨테이너 이름}</span> ubuntu:18.04 /bin/bash\n    <span class=\"token comment\"># -i : 사용자 입출력 가능 옵션</span>\n    <span class=\"token comment\"># -t : Bash 사용</span>\n    <span class=\"token comment\"># --network : 해당 네트워크에 연결</span>\n    <span class=\"token comment\"># -p : 포트 포워딩 = ${호스트OS 접속포트}:${컨테이너 연결포트}</span>\n    <span class=\"token comment\"># -v : 파일시스템 볼륨 연결 = ${연결할 호스트OS 디렉토리}:${연결될 컨테이너 디렉토리}</span>\n    <span class=\"token comment\"># -d : Bast 미사용컨테이너를 데몬 프로세스 형태로 실행하여 유지</span>\n    <span class=\"token comment\"># --name : 컨테이너 이름 지정</span>\n    <span class=\"token comment\"># /bin/bash : 컨테이너가 지속적으로 실행할 파일을 지정한 것(변경 가능)</span>\n\n<span class=\"token comment\"># 실행중인 컨테이너 확인</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">ps</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 컨테이너 전체 목록 확인</span>\n<span class=\"token comment\"># (이전에 종료되었던 컨테이너 포함)</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">ps</span> -a\n\n<span class=\"token comment\"># 기존에 생성되어 있는 컨테이너 시작</span>\n<span class=\"token function\">docker</span> start -i <span class=\"token string\">\"컨테이너_이름\"</span></code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"3\">\n<li>\n<p>컨테이너 접속 및 종료</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 호스트 OS에서</span>\n<span class=\"token comment\"># 컨테이너 접속</span>\n<span class=\"token function\">docker</span> attach <span class=\"token string\">\"컨테이너_이름\"</span>\n\n<span class=\"token comment\"># 컨테이너 종료</span>\n<span class=\"token function\">docker</span> stop <span class=\"token string\">\"컨테이너_이름\"</span>\n\n<span class=\"token comment\"># 컨테이너에 실행명령</span>\n<span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> -it <span class=\"token variable\">${컨테이너 이름}</span> 스크립트\n<span class=\"token comment\"># -it : 컨테이너 지속연결 유지</span>\n\n<span class=\"token comment\"># 컨테이너에서</span>\n<span class=\"token comment\"># 호스트 OS로 복귀(컨테이너 유지)</span>\nCtrl + p, q\n\n<span class=\"token comment\"># 컨테이너 종료</span>\n<span class=\"token builtin class-name\">exit</span> / Ctrl + d</code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"4\">\n<li>\n<p>컨테이너 볼륨</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 볼륨 생성</span>\n<span class=\"token function\">docker</span> volume create <span class=\"token variable\">${볼륨 이름}</span>\n\n<span class=\"token comment\"># 컨테이너에서 볼륨 마운트 해제(종료 먼저 필요)</span>\n<span class=\"token function\">docker</span> container <span class=\"token function\">rm</span> <span class=\"token variable\">${볼륨 이름}</span>\n\n<span class=\"token comment\"># 볼륨 삭제</span>\n<span class=\"token function\">docker</span> volume <span class=\"token function\">rm</span> <span class=\"token variable\">${볼륨 이름}</span></code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"5\">\n<li>\n<p>DB 컨테이너 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Postgres 이미지 받아오기</span>\n<span class=\"token function\">docker</span> image pull postgres:14\n\n<span class=\"token comment\"># DB 컨테이너 생성</span>\n<span class=\"token comment\"># 로컬 DB랑 포트 겹치지 않게 주의!</span>\n<span class=\"token function\">docker</span> run --network sf1 -p <span class=\"token number\">4321</span>:5432 --name pg14 -e <span class=\"token assign-left variable\">POSTGRES_PASSWORD</span><span class=\"token operator\">=</span>0000 -e <span class=\"token assign-left variable\">TZ</span><span class=\"token operator\">=</span>Asia/Seoul -v /database/pgdata:/var/lib/postgresql/data -v D:<span class=\"token punctuation\">\\</span>repo<span class=\"token punctuation\">\\</span>Package<span class=\"token punctuation\">\\</span>sf1-v7-package:/data/volume -d postgres:14 \n<span class=\"token comment\"># docker run -p 5432:5432 --name pg14</span>\n<span class=\"token comment\"># -e POSTGRES_PASSWORD=0000</span>\n<span class=\"token comment\"># -e TZ=Asia/Seoul</span>\n<span class=\"token comment\"># -v /database/pgdata:/var/lib/postgresql/data -d</span>\n<span class=\"token comment\"># -v D:\\repo\\Package\\sf1-v7-package:/data/volume</span>\n<span class=\"token comment\"># postgres:14</span>\n\n<span class=\"token comment\"># DB 컨테이너 접속</span>\n<span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> -it pg14 /bin/bash</code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"6\">\n<li>\n<p>DB 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 외부 접속 허용</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">vi</span> /var/lib/postgresql/data/postgresql.conf\n\tlisten_addresses <span class=\"token operator\">=</span> <span class=\"token string\">'*'</span>\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">vi</span> /var/lib/postgresql/data/pg_hba.conf\n<span class=\"token comment\"># 아래의 내용중 원하는 내용을 기존 내용에 `추가`로 삽입한다!</span>\n\t<span class=\"token comment\"># /24 => Subnet Mask 255.255.255.0 (맨 끝자리만 범위 허용)</span>\n\t<span class=\"token comment\"># /32 => Subnet Mask 255.255.255.255 (정확히 일치하는 IP만 허용)</span>\n\t<span class=\"token comment\"># 모든 IP 허용</span>\n\t<span class=\"token function\">host</span>  all all <span class=\"token number\">0.0</span>.0.0/0  trust\n\t\n\t<span class=\"token comment\"># 특정 IP 대역 허용 (ex : 192.168.0.1 ~ 192.168.0.255)</span>\n\t<span class=\"token function\">host</span>  all  all <span class=\"token variable\">${외부IP}</span>/24  trust\n\t\n\t<span class=\"token comment\"># 특정 IP 만 허용</span>\n\t<span class=\"token function\">host</span>  all  all <span class=\"token variable\">${외부IP}</span>/32  trust\n\n<span class=\"token comment\"># 컨테이너 재시작</span>\n<span class=\"token builtin class-name\">exit</span>\n<span class=\"token function\">docker</span> start -i pg14\n\n<span class=\"token comment\"># Postgres 로그인</span>\npsql -U postgres\n\n<span class=\"token comment\"># DB 및 스키마 생성</span>\npsql -U postgres\nCREATE DATABASE <span class=\"token string\">\"sf1-manager\"</span> OWNER postgres<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">\\</span>c <span class=\"token string\">\"sf1-manager\"</span>\nCREATE SCHEMA <span class=\"token string\">\"sf1v7_manager\"</span>\n\n<span class=\"token comment\"># 패키지 스크립트로 테이블 생성</span>\n<span class=\"token builtin class-name\">cd</span> /data/volume/batch\n./manager.sh postgresql_table createdb</code></pre></div>\n</li>\n<li>\n<p>호스트OS에 연결한 볼륨에서 필요한 설정파일 복사</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 파일 복사 (반대도 가능함)</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">cp</span> <span class=\"token string\">\"호스트 OS 파일경로\"</span> <span class=\"token string\">\"컨테이너 복사위치\"</span></code></pre></div>\n</li>\n<li>\n<p>서비스 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 자신의 서비스를 실행하는 코드</span></code></pre></div>\n</li>\n</ol>\n<br>\n<h2 id=\"q--a\" style=\"position:relative;\"><a href=\"#q--a\" aria-label=\"q  a permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q &#x26; A</h2>\n<ul>\n<li>\n<p>sudo, vi 명령이 동작하지 않아요</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt-get</span> update\n\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">vim</span></code></pre></div>\n</li>\n<li>\n<p>컨테이너, 볼륨 이름을 변경하고 싶어요</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 컨테이너 이름 변경</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">rename</span> <span class=\"token string\">\"old\"</span> <span class=\"token string\">\"new\"</span>\n\n<span class=\"token comment\"># 볼륨 이름 변경</span>\n<span class=\"token function\">docker</span> volume create --name <span class=\"token variable\">${new_volume}</span>\n<span class=\"token function\">docker</span> run --rm -it -v <span class=\"token variable\">${old_volume}</span>:/from -v <span class=\"token variable\">${new_volume}</span>:/to <span class=\"token variable\">${컨테이너이름}</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"cd /from ; cp -av . /to\"</span>\n<span class=\"token function\">docker</span> volume <span class=\"token function\">rm</span> <span class=\"token variable\">${old_volume}</span></code></pre></div>\n</li>\n</ul>\n<br>\n<hr>\n<br>\n<h2 id=\"더-나은-여정-준비\" style=\"position:relative;\"><a href=\"#%EB%8D%94-%EB%82%98%EC%9D%80-%EC%97%AC%EC%A0%95-%EC%A4%80%EB%B9%84\" aria-label=\"더 나은 여정 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>더 나은 여정 준비</h2>\n<br>\n<p>다음 편에는 <code class=\"language-text\">dockerfile</code>과 <code class=\"language-text\">docker-compose</code>를 활용해</p>\n<p>이러한 과정을 간소화해보도록 하겠다.</p>\n<br>\n<hr>\n<br>\n<p>참고자료</p>\n<p><em><a href=\"https://learn.microsoft.com/ko-kr/visualstudio/docker/tutorials/tutorial-multi-container-app-mysql\">MySQL 및 Docker Compose를 사용하여 다중 컨테이너 앱 만들기 | Microsoft Learn</a></em></p>\n<p><em><a href=\"https://jokeyyy.tistory.com/33\">[Docker] 다중 컨테이너 앱 (tistory.com)</a></em></p>\n<p><em><a href=\"https://yjkim97.tistory.com/60\">[PostgreSQL] PostgreSQL docker 설치 및 외부접속 (tistory.com)</a></em></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%97%90-%EC%95%9E%EC%84%9C\">들어가기에 앞서..</a></li>\n<li><a href=\"#%ED%98%84%EC%9E%AC-%EC%83%81%ED%99%A9\">현재 상황</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#%EC%97%AC%EC%A0%95\">여정</a></li>\n<li><a href=\"#q--a\">Q &#x26; A</a></li>\n<li><a href=\"#%EB%8D%94-%EB%82%98%EC%9D%80-%EC%97%AC%EC%A0%95-%EC%A4%80%EB%B9%84\">더 나은 여정 준비</a></li>\n</ul>\n</div>","excerpt":"지적과 댓글은 언제나 환영합니다! 들어가기에 앞서.. 현재 상황 현재 가지고 있는 MSA 형태의 어플리케이션의 구조는 아래와 같다.  서비스 별로 실행파일이 분리가 되어 API 요청으로 통신하고 있긴 하지만, 실행 시, 같은 디렉토리 내에서 상대위치 참조를 하고 있다. 즉, 물리적으로 분리가 어려운 상태이다. 따라서, 단계적, 점진적으로 도커라이징하고자 한다. 목표 이번 글에서는 를 하려고 한다. 어플리케이션(MSA를 통째로) 과 DB를 각각 컨테이너화 어플리케이션과 DB가 각각 다른 볼륨(Volume)을 가짐 같은 내부 네트워크로 연결 여정 이미지 검색 컨테이너 생성 및 실행 컨테이너 접속 및 종료 컨테이너 볼륨 DB 컨테이너 생성 DB 설정 호스트OS에 연결한 볼륨에서 필요한 설정파일 복사 서비스 실행 Q & A sudo, vi 명령이 동작하지 않아요 컨테이너, 볼륨 이름을 변경하고 싶어요 더 나은 여정 준비 다음 편에는 과 를 활용해 이러한 과정을 간소화해보도록 하겠다. 참고…","frontmatter":{"date":"December 15, 2022","title":"MSA 도커라이징(Dockerizing) 1편, 삽질하기","categories":"infra","author":"주녁","emoji":"🔮"},"fields":{"slug":"/dockerize-msa-basic/"}},"next":{"id":"cd5bc358-6208-53e8-8710-5a451efe3419","html":"<p>지적과 댓글은 언제나 환영합니다!</p>\n<p>이 글은 박재성님의 <code class=\"language-text\">자바 플레이그라운드 with TDD, 클린코드</code> 강의를 바탕으로 작성되었습니다.</p>\n<p><br/><br/></p>\n<h1 id=\"tdd\" style=\"position:relative;\"><a href=\"#tdd\" aria-label=\"tdd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD</h1>\n<br>\n<h2 id=\"tdd를-하는-이유\" style=\"position:relative;\"><a href=\"#tdd%EB%A5%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"tdd를 하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD를 하는 이유</h2>\n<ul>\n<li>\n<p>디버깅 시간을 줄여준다.</p>\n</li>\n<li>\n<p>동작하는 문서 역할을 한다.</p>\n</li>\n<li>\n<p>변화에 대한 두려움을 줄여준다.</p>\n</li>\n</ul>\n<br>\n<hr>\n<h2 id=\"tdd-프로세스\" style=\"position:relative;\"><a href=\"#tdd-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4\" aria-label=\"tdd 프로세스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 프로세스</h2>\n<ul>\n<li>\n<p>실패하는 테스트를 구현한다.</p>\n</li>\n<li>\n<p>테스트가 성공하도록 프로덕션 코드를 구현한다.</p>\n</li>\n<li>\n<p>프로덕션 코드와 테스트 코드를 리팩토링한다.</p>\n</li>\n</ul>\n<p>(테스트 코드도 중복이 발생할 수 있기 때문)</p>\n<br>\n<hr>\n<h2 id=\"tdd-원칙\" style=\"position:relative;\"><a href=\"#tdd-%EC%9B%90%EC%B9%99\" aria-label=\"tdd 원칙 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 원칙</h2>\n<ol>\n<li>\n<p>실패하는 단위 테스트를 작성할 때까지 프로덕션 코드를 작성하지 않는다.</p>\n</li>\n<li>\n<p>컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.</p>\n</li>\n<li>\n<p>현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다(미래까지 걱정 X)</p>\n</li>\n</ol>\n<br>\n<hr>\n<h2 id=\"tdd-방법론-필수는-아님\" style=\"position:relative;\"><a href=\"#tdd-%EB%B0%A9%EB%B2%95%EB%A1%A0-%ED%95%84%EC%88%98%EB%8A%94-%EC%95%84%EB%8B%98\" aria-label=\"tdd 방법론 필수는 아님 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 방법론 (필수는 아님!)</h2>\n<br>\n<h3 id=\"큰-갈래에서\" style=\"position:relative;\"><a href=\"#%ED%81%B0-%EA%B0%88%EB%9E%98%EC%97%90%EC%84%9C\" aria-label=\"큰 갈래에서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>큰 갈래에서</h3>\n<ul>\n<li>\n<p>테스트 하기 어려운 부분을 분리하라 (랜덤, UI 등)</p>\n</li>\n<li>\n<p>함수(또는 메소드)가 한 가지 일만 하도록 최대한 작게 만들어라.</p>\n</li>\n<li>\n<p>모든 로직에 단위 테스트를 구현한다. 단, UI(System.out, System.in) 로직은 제외</p>\n</li>\n<li>\n<p>핵심 로직을 구현하는 코드와 UI를 담당하는 로직을 구분한다.</p>\n</li>\n</ul>\n<br>\n<h3 id=\"작은-갈래에서\" style=\"position:relative;\"><a href=\"#%EC%9E%91%EC%9D%80-%EA%B0%88%EB%9E%98%EC%97%90%EC%84%9C\" aria-label=\"작은 갈래에서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>작은 갈래에서</h3>\n<ul>\n<li>\n<p>코드 컨벤션을 지키면서 프로그래밍한다.</p>\n</li>\n<li>\n<p>indent(인덴트, 들여쓰기) depth를 2가 넘지 않도록 구현한다. 1까지만 허용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  예를 들어 while문 안에 if문이 있으면 들여쓰기는 2이다.\n  depth를 줄이는 좋은 방법은 함수(또는 메소드)를 분리하면 된다.</code></pre></div>\n</li>\n<li>\n<p>else 예약어를 쓰지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  if 조건절에서 값을 return하는 방식으로 구현\n  switch/case도 허용하지 않는다.</code></pre></div>\n</li>\n<li>\n<p>3항 연산자를 쓰지 않는다.</p>\n</li>\n</ul>\n<br>\n<h2 id=\"테스트-가능-구조\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%80%EB%8A%A5-%EA%B5%AC%EC%A1%B0\" aria-label=\"테스트 가능 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 가능 구조</h2>\n<br>\n<p>테스트는 언제 어디서든 실행하면, 성공해야 한다.</p>\n<p>테스트 하기 어려운 구조(Random, Private Method 등)를</p>\n<p>어떻게하면 큰 변경없이 테스트를 성공할 수 있을까?</p>\n<br>\n<ul>\n<li>\n<p>메소드가 접근자가 private인 경우, protected로 변경하면 테스트 가능 구조로 변경할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  기존 레거시 코드가 있을 때, \n  메소드 시그니처(이름, 매개변수 등)을 변경하지 않고\n  테스트 가능하도록 만드는 과도기적인 단계에서 사용하는 방법이다.\n\n  결과적으로는 public으로 테스트 가능하도록\n  메소드, 클래스의 역할을 적절하게 분리하는 것이 필요하다.</code></pre></div>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// CarTest.java</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">MoveTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Car</span> car <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Car</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">protected</span> in <span class=\"token function\">gerRandomNo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token comment\">// return new Random().nextInt(9);</span>\n                        <span class=\"token comment\">// 랜덤값을 고정값으로 대체할 수 있다.</span>\n                        <span class=\"token keyword\">return</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        car<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">.</span><span class=\"token function\">getPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<hr>\n<br>\n<ul>\n<li>\n<p>인터페이스를 활용하여 분리하라</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  Spring이 아니여도 DI를 사용할 수 있다.\n  Interface를 통해 동작을 분리하고 \n  외부에서 주입받도록 하라.</code></pre></div>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@FunctionalInterface</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MovingStrategy</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">movable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">MovingStrategy</span> strategy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MovingStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">movable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// return getRandomNo() >= OIL_THRESHOLD;</span>\n                <span class=\"token comment\">// 랜덤값을 고정값으로 대체할 수 있다.</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// MovingStrategy strategy = () -> false 로 대체 가능</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">.</span>DEFAULT_DISTANCE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>car<span class=\"token punctuation\">.</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">.</span>DEFAULT_DISTANCE <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<ul>\n<li>\n<p>인스턴스에 의존하는 메서드의 경우,</p>\n<p>인스턴스를 인자로 넘겨주는 방식으로 변경하여 의존성을 제거한다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cars</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">></span></span> cars<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Cars</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">></span></span> cars<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cars <span class=\"token operator\">=</span> cars<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findWinners</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 이 경우 테스트할 때, static findWinners()만 테스트를 하면 되고,</span>\n        <span class=\"token comment\">// 실제 사용은 Cars.findWinners()를 사용하면 된다.</span>\n        <span class=\"token comment\">// 테스트하기 쉬운 구조로 변경된다.</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">findWinners</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cars<span class=\"token punctuation\">,</span> <span class=\"token function\">getMaxPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findWinners</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Car</span><span class=\"token punctuation\">></span></span> cars<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Position</span> maxPosition<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> cars<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>car <span class=\"token operator\">-></span> car<span class=\"token punctuation\">.</span><span class=\"token function\">getPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>maxPosition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Position</span> <span class=\"token function\">getMaxPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> cars<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Car</span><span class=\"token operator\">::</span><span class=\"token function\">getPosition</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Position</span><span class=\"token operator\">::</span><span class=\"token function\">compareTo</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"우승한 자동차가 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">/* \n    public List&lt;Car> findWinners(Position maxPosition) {\n        이 메소드는 테스트할 때, \n        Position 생성자와 같이 테스트해야 하므로 단일 테스트가 어렵다.\n        return cars.stream()\n                .filter(car -> car.getPosition().equals(maxPosition))\n                .collect(Collectors.toList());\n    }\n    */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h1 id=\"clean-code\" style=\"position:relative;\"><a href=\"#clean-code\" aria-label=\"clean code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clean Code</h1>\n<h2 id=\"클린코드-가이드-필수는-아님\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%A6%B0%EC%BD%94%EB%93%9C-%EA%B0%80%EC%9D%B4%EB%93%9C-%ED%95%84%EC%88%98%EB%8A%94-%EC%95%84%EB%8B%98\" aria-label=\"클린코드 가이드 필수는 아님 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클린코드 가이드 (필수는 아님!)</h2>\n<br>\n<h3 id=\"1-의미-있는-이름\" style=\"position:relative;\"><a href=\"#1-%EC%9D%98%EB%AF%B8-%EC%9E%88%EB%8A%94-%EC%9D%B4%EB%A6%84\" aria-label=\"1 의미 있는 이름 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 의미 있는 이름</h3>\n<br>\n<ul>\n<li>\n<p>의도를 분명히 밝혀라</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  좋은 이름을 지으려면 시간이 걸리지만,\n  좋은 이름으로 절약하는 시간 이 훨씬 더 많다.</code></pre></div>\n</li>\n<li>\n<p>그릇된 정보를 피하라</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  서로 흡사한 이름을 사용하지 않도록 주의한다.\n  유사한 개념은 유사한 표기법을 사용한다.</code></pre></div>\n</li>\n<li>\n<p>의미 있게 구분하라</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  이름이 다르면 의미도 달라져야 한다.\n  숫자를 붙이거나(a1, b2...), 불용어를 추가하는 방식(__Info, __Data...)은 적절하지 않다.</code></pre></div>\n</li>\n<li>\n<p>인터페이스와 구현 클래스</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  인터페이스의 접두어 'I'를 붙이는 것(IShape -> Shape)보다\n  ShapeFactory처럼 구현체의 의도를 드러낼 수 있는 것이 좋다.</code></pre></div>\n</li>\n<li>\n<p>클래스 이름</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  클래스 이름과 객체 이름은 명사나 명사구가 좋다.\n  (ex : Customer, WikiPage, AddressParser)\n  Manager, Processor, Data, Info 등과 같은 단어는 피한다.\n  동사는 사용하지 않는다.</code></pre></div>\n</li>\n<li>\n<p>메소드 이름</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  메소드 이름은 동사나 동사구가 적합하다.\n  (ex : postPayment, deletePage, save)\n  접근자, 변경자, 조건자는 자바 빈 표준에 따라 get, set, is를 붙인다.\n  생성자를 중복해 정의할 때는 정적 팩토리 메소드를 사용한다.</code></pre></div>\n</li>\n<li>\n<p>개념 하나에 단어 하나를 사용하라</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  추상적인 개념 하나에 단어 하나를 선택하고 고수하라.\n  일관성 있는 어휘는 코드를 사용할 프로그래머가 반갑게 여길 선물이다.</code></pre></div>\n</li>\n<li>\n<p>줄여쓰지 않는다(축약 금지)</p>\n</li>\n</ul>\n<br>\n<h2 id=\"2-경계\" style=\"position:relative;\"><a href=\"#2-%EA%B2%BD%EA%B3%84\" aria-label=\"2 경계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 경계</h2>\n<ul>\n<li>\n<p>외부 코드 사용하기</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  Map, List와 같은 Collection을 외부에 노출하는 경우\n  사용자는 너무 많은 인터페이스에 노출된다.\n\n  경계에서 사용할 클래스를 만들어 인터페이스를 숨긴다면,\n  경계 클래스 내부 구조가 바뀌더라도 외부 인터페이스에 변경사항이 발생하지 않는다.</code></pre></div>\n</li>\n<li>\n<p>도메인 객체에는 Setter/Getter 메소드를 가능한 사용하지 마라.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  DTO에서는 Setter/Getter를 사용하되 \n  도메인 객체는 가능한 사용하지 않도록 노력하라.\n  대신, 직접 객체를 조작하는 대신\n  메시지를 보낼 수 있도록 동작을 이관하자.\n\n  객체를 비교할 때, \n  equals() Override로 객체 == 객체가 되도록 비교하라.\n  객체지향적인 프로그래밍의 기본이다.\n\n  값을 증감 등 연산할 때, \n  메시지를 보낼 수 있도록 해라.</code></pre></div>\n</li>\n<li>\n<p>모든 원시값과 문자열을 포장한다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Position</span> <span class=\"token function\">move</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> toMove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 조작할 일이 많이 없거나, 안정성(불변 상태) 우선인 경우</span>\n        <span class=\"token comment\">// return new Position(position + toMove);</span>\n\n        <span class=\"token comment\">// 성능(인스턴스 Garbage Collection 최소) 우선인 경우</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distance <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>distance <span class=\"token operator\">+</span> toMove<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    primitive값을 직접 조작하는 대신 Class로 포장하자.\n    이 때도 역시, Setter/Getter를 피해야 한다.\n\n    final 키워드로 멤버변수를 불변(immutable) 상태를 만드는 것은 좋은 전략이다.\n    다만, 값의 증감 등 연산할 때 인스턴스가 만들어질 수 있기 때문에\n    적절한 타협이 필요하다.</code></pre></div>\n<ul>\n<li>\n<p>역할 분리를 위해 클래스를 분리하는 것은 긍정적이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  클래스 분리는 성능에 미치는 부정적 영향보다,\n  유지보수와 테스트를 쉽게 하는 긍정적 영향이 더 크다.        </code></pre></div>\n</li>\n<li>\n<p>다양한 생성자를 지원하는 것은 좋은 방법 중 하나이다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Position.java</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> DEFAULT_DISTANCE <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Position</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">(</span>DEFAULT_DISTANCE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">Position</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> position<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>position <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"position은 음수 값을 가질 수 없습니다\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> position<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<br>\n<p><em>참고자료</em></p>\n<p><em><a href=\"https://www.youtube.com/watch?v=WBVjBwKx47I&#x26;list=WL&#x26;index=53\">최범균님의 테스트 가능 구조</a></em></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#tdd%EB%A5%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\">TDD를 하는 이유</a></p>\n</li>\n<li>\n<p><a href=\"#tdd-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4\">TDD 프로세스</a></p>\n</li>\n<li>\n<p><a href=\"#tdd-%EC%9B%90%EC%B9%99\">TDD 원칙</a></p>\n</li>\n<li>\n<p><a href=\"#tdd-%EB%B0%A9%EB%B2%95%EB%A1%A0-%ED%95%84%EC%88%98%EB%8A%94-%EC%95%84%EB%8B%98\">TDD 방법론 (필수는 아님!)</a></p>\n<ul>\n<li><a href=\"#%ED%81%B0-%EA%B0%88%EB%9E%98%EC%97%90%EC%84%9C\">큰 갈래에서</a></li>\n<li><a href=\"#%EC%9E%91%EC%9D%80-%EA%B0%88%EB%9E%98%EC%97%90%EC%84%9C\">작은 갈래에서</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%80%EB%8A%A5-%EA%B5%AC%EC%A1%B0\">테스트 가능 구조</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%81%B4%EB%A6%B0%EC%BD%94%EB%93%9C-%EA%B0%80%EC%9D%B4%EB%93%9C-%ED%95%84%EC%88%98%EB%8A%94-%EC%95%84%EB%8B%98\">클린코드 가이드 (필수는 아님!)</a></p>\n<ul>\n<li><a href=\"#1-%EC%9D%98%EB%AF%B8-%EC%9E%88%EB%8A%94-%EC%9D%B4%EB%A6%84\">1. 의미 있는 이름</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#2-%EA%B2%BD%EA%B3%84\">2. 경계</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"December 11, 2022","title":"TDD, Clean Code With Me","categories":"how-to","author":"주녁","emoji":"🔮"},"fields":{"slug":"/about-TDD-and-CleanCode/"}},"prev":{"id":"aed9ef66-df48-5c4d-9b10-c864fd28227d","html":"<p>지적과 댓글은 언제나 환영합니다!</p>\n<br>\n<hr>\n<br>\n<h1 id=\"도커-삽질-개선하기\" style=\"position:relative;\"><a href=\"#%EB%8F%84%EC%BB%A4-%EC%82%BD%EC%A7%88-%EA%B0%9C%EC%84%A0%ED%95%98%EA%B8%B0\" aria-label=\"도커 삽질 개선하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>도커 삽질 개선하기</h1>\n<br>\n<h2 id=\"이전편-요약\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%84%ED%8E%B8-%EC%9A%94%EC%95%BD\" aria-label=\"이전편 요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이전편 요약</h2>\n<p>이전 편 <a href=\"https://www.junwork.net/dockerize-msa-basic/\">도커 삽질하기</a> 에서는 단순 리눅스 컨테이너를 생성해서</p>\n<p>직접 명령어를 타이핑하면서, 컨테이너의 상태를 변경하였다.</p>\n<br>\n<p>그 결과, 컨테이너가 재부팅되면 대부분의 데이터와 상태가 소실되어</p>\n<p>같은 과정을 반복해야 했다.</p>\n<br>\n<hr>\n<br>\n<h2 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h2>\n<p>도커 컨테이너 설정을 간소화, 자동화해보자</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACf0lEQVQoz22Sy09TQRSH+6/4v7gyJorGnRFNDEskutBERBGjxI1gdQGEiFHBBykg7/JGKPRFS6EiLfRBW/ru7W2hpb2PT9tb0IW/ZOaczJz5zpyZo0tFDzH2dOCcGaUiVVFQVVXzVfXMD4fC7Pg2OC7mqAVWpqr9N17nGhtAf/sKC+MaUFEUZFUbkiJXbUWvX7bzpKOBeNKDtGclYZsgYZ8m6zSiZA9RToHNX0ycuz/Izb41VEXifwpG4+i7ehiamgO5RMmzSnh9HO/SMPmtORDCtUgV3fxOlFH7Psl0proUKwpMxTcwJpxMxOzYsnsUikUcDgexeLR6SHLPkFgxsG38juocRoxH2IwUSOVL6KqQRA4VrbSvhz84v9JCnaWdC2tt3LB1IspHBCNHuPxH7HsC5L49ROy/hzDwgGJ/I0HLLC9mE1h8WQ3o8GZx+bL4gid0bs9St/yUa9NtXJ56TIPjDYKco5JPKKikwwfkB5sJ9Dax29VI8n0Ti+NGno36sPsFDSjJCmKhhFSE7r05LprauLrQxqXFVurNb9lLpzg+lsmXQIxFSAw8IvqukYPeOxx/asK1MMnzyRA2n4Du9MurLQDMJBxc33jFLXM39Q49d9f72fCm+OnPsu0X2dyJETDoyRlaiQ62I4+0cOAyo19O4gyK2g0rUKUGDhVSjEXMfHCu8dW7iklwnyXTJEHQSsQ2z65pkZNfS5RzKcQTlbKkaMBq/9WArlyAPo+RLouBLusQw+F18uVilVn5NqWQp7A1i3/+M7vTH8lYRlBTgb9tcwo8LT1azGARvFjTXixpD1tikLIinz2KKpWQYx7KYTcnITdyxI1ylNH2/jT2b6+3Db80o/CtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"msa\"\n        title=\"msa\"\n        src=\"/static/c4fef21cd9c5f1b37ad7342abc8dbf37/37523/msa.png\"\n        srcset=\"/static/c4fef21cd9c5f1b37ad7342abc8dbf37/e9ff0/msa.png 180w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/f21e7/msa.png 360w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/37523/msa.png 720w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/302a4/msa.png 1080w,\n/static/c4fef21cd9c5f1b37ad7342abc8dbf37/5d942/msa.png 1343w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>공통 설정 분리 → env 파일 생성</p>\n</li>\n<li>\n<p>DB에 대한 dockerfile 작성 → 이미지 생성</p>\n</li>\n<li>\n<p>Package(서브도메인B, 지원도메인D)에 대한 dockerfile 작성 → 이미지 생성</p>\n</li>\n<li>\n<p>docker-compose를 이용해서 실행</p>\n</li>\n</ul>\n<br>\n<hr>\n<h2 id=\"여정\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EC%A0%95\" aria-label=\"여정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여정</h2>\n<ol>\n<li>\n<p>env 파일로 설정 분리</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># DB Configuration</span>\nTZ=Asia/Seoul\nDB_HOST=0.0.0.0 # 외부 DB와 연결하고 싶을 때 DB IP 입력\nDB_KIND=postgresql # oracle, tibero\nDB_NAME=db\nDB_SCHEMA_NAME=schema\nDB_USER=postgres\nDB_PASSWORD=0000\nDB_PORT_IN=5432\nDB_PORT_OUT=5432\n\n<span class=\"token comment\"># SERVICE_B Configuration</span>\nSERVICE_B_IP=0.0.0.0 # 관리도구를 실행할 호스트의 IP로 변경\nSERVICE_B_NAME=SERVICE_B\nSERVICE_B_PORT_IN=8080\nSERVICE_B_PORT_OUT=8080\n\n<span class=\"token comment\"># SERVICE_D Configuration</span>\nSERVICE_D_NAME=kit1\nSERVICE_D_PORT_IN=8888\nSERVICE_D_PORT_OUT=8888\nSERVICE_D_CACHE_PORT_IN=8900\nSERVICE_D_CACHE_PORT_OUT=8900</code></pre></div>\n</li>\n<li>\n<p>SERVICE_B에 대한 dockerfile 작성</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># database.properties 설정파일 예시</span>\n\nschema.name=$<span class=\"token punctuation\">{</span>DB_SCHEMA_NAME<span class=\"token punctuation\">}</span>\nspring.datasource.username=$<span class=\"token punctuation\">{</span>DB_USER<span class=\"token punctuation\">}</span>\nspring.datasource.password=$<span class=\"token punctuation\">{</span>DB_PASSWORD<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Postgresql</span>\nspring.datasource.url=jdbc<span class=\"token punctuation\">:</span>postgresql<span class=\"token punctuation\">:</span>//$<span class=\"token punctuation\">{</span>DB_HOST<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>DB_PORT<span class=\"token punctuation\">}</span>/$<span class=\"token punctuation\">{</span>DB_NAME<span class=\"token punctuation\">}</span><span class=\"token punctuation\">?</span>useUnicode=true<span class=\"token important\">&amp;characterEncoding=utf8&amp;currentSchema=$</span><span class=\"token punctuation\">{</span>DB_SCHEMA_NAME<span class=\"token punctuation\">}</span>\nspring.datasource.driver<span class=\"token punctuation\">-</span>class<span class=\"token punctuation\">-</span>name=org.postgresql.Driver\nspring.jpa.hibernate.dialect=org.hibernate.dialect.PostgreSQL10Dialect</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># APPLICATION</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> openjdk:8-jdk-alpine</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> APPNAME SERVICE_B</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> WORKDIR /home/<span class=\"token variable\">$APPNAME</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token variable\">$WORKDIR</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> ./target/lib <span class=\"token variable\">$WORKDIR</span>/lib</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> ./conf <span class=\"token variable\">$WORKDIR</span>/conf</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span>  ./target/SERVICE_B-7.1.0.jar <span class=\"token variable\">$WORKDIR</span>/lib/SERVICE_B-7.1.0.jar</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [ <span class=\"token string\">\"java\"</span>, ... ]</span></code></pre></div>\n</li>\n<li>\n<p>SERVICE_D에 대한 dockerfile 작성</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># SERVICE_D</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> openjdk:8-jdk-alpine</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> APPNAME SERVICE_D</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> WORKDIR /home/<span class=\"token variable\">$APPNAME</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token variable\">$WORKDIR</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> ark  <span class=\"token variable\">$WORKDIR</span>/ark</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> conf <span class=\"token variable\">$WORKDIR</span>/conf</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> ./target/SERVICE_D-7.1.0.jar <span class=\"token variable\">$WORKDIR</span>/app.jar</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [<span class=\"token string\">\"java\"</span>, <span class=\"token string\">\"-jar\"</span>, <span class=\"token string\">\"app.jar\"</span>,<span class=\"token string\">\"$NODENAME\"</span>, <span class=\"token string\">\"start\"</span> ]</span></code></pre></div>\n</li>\n<li>\n<p>DB에 대한 dockerfile 작성 및 이미지 빌드</p>\n<ul>\n<li>\n<p>컨테이너 내부 DB 이용하는 경우(Docker_db 파일)</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># Database</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> postgres:14</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> APPNAME DBinstaller</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> WORKDIR /home/<span class=\"token variable\">$APPNAME</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token variable\">$WORKDIR</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> conf <span class=\"token variable\">$WORKDIR</span>/conf</span>\n\n<span class=\"token comment\"># 타임존 설정</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> ln -snf /usr/share/zoneinfo/<span class=\"token variable\">$TZ</span> /etc/localtime <span class=\"token operator\">\\</span>\n    &amp;&amp; echo <span class=\"token variable\">$TZ</span> > /etc/timezone</span>\n\n<span class=\"token comment\"># update 및 패키지 설치, init 명령어 등록</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt update <span class=\"token operator\">\\</span>\n    &amp;&amp; apt install -y sudo sed <span class=\"token operator\">\\</span>\n    &amp;&amp; cat <span class=\"token variable\">$WORKDIR</span>/conf/init.sh >> /bin/init <span class=\"token operator\">\\</span>\n    &amp;&amp; chmod u+x /bin/init</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token comment\"># Create a database and initialize it</span>\n<span class=\"token assign-left variable\">SQL_FILE_PATH</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$WORKDIR</span>\"</span>/conf/postgresql_table.sql\n<span class=\"token function\">sudo</span> <span class=\"token function\">sed</span> -i <span class=\"token string\">\"s/{SERVICE_B_SCHEMA_NAME}/<span class=\"token variable\">$DB_SCHEMA_NAME</span>/g\"</span> SQL_FILE_PATH\n<span class=\"token function\">su</span> postgres -c <span class=\"token string\">'psql -U \"$DB_USER\" -c \"CREATE DATABASE $DB_NAME\"'</span>\n<span class=\"token function\">su</span> postgres -c <span class=\"token string\">'psql -U \"$DB_USER\" -d \"$DB_NAME\" -c \"CREATE SCHEMA $DB_SCHEMA_NAME\"'</span>\n<span class=\"token function\">su</span> postgres -c <span class=\"token string\">'psql -U \"$DB_USER\" -d \"$DB_NAME\" -a -f $SQL_FILE_PATH'</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">docker build <span class=\"token punctuation\">-</span>f Dockerfile_db <span class=\"token punctuation\">-</span>t pg14<span class=\"token punctuation\">:</span>7.1.0 .</code></pre></div>\n</li>\n<li>\n<p>외부 DB를 연결하는 경우</p>\n<p>→ Dockerfile 작성 X</p>\n<p>→ 설정파일에서 <code class=\"language-text\">DATABASE_HOST</code>  주석을 풀고 다음 단계로 진행</p>\n</li>\n</ul>\n</li>\n<li>\n<p>docker-compose 작성</p>\n<ul>\n<li>\n<p>컨테이너 내부 DB 이용하는 경우(docker-compose.yml)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">services:\n    database:\n        image: mypg:7.1.0\n        container_name: db_instance\n        restart: unless-stopped\n        ports:\n          - <span class=\"token variable\">${DB_PORT_IN}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">${DB_PORT_OUT}</span>\n        volumes:\n          - db_storage:/var/lib/postgresql/data\n        environment:\n          DB_KIND: <span class=\"token variable\">${DB_KIND}</span>\n          DB_NAME: <span class=\"token variable\">${DB_NAME}</span>\n          DB_SCHEMA_NAME: <span class=\"token variable\">${DB_SCHEMA_NAME}</span>\n          DB_USER: <span class=\"token variable\">${DB_USER}</span>\n          POSTGRES_PASSWORD: <span class=\"token variable\">${DB_PASSWORD}</span>\n          TZ: <span class=\"token variable\">${TZ}</span>\n        healthcheck:\n          test: <span class=\"token punctuation\">[</span><span class=\"token string\">\"CMD\"</span>, <span class=\"token string\">\"pg_isready\"</span>, <span class=\"token string\">\"-U\"</span>, <span class=\"token string\">\"postgres\"</span><span class=\"token punctuation\">]</span>\n          interval: 10s\n          timeout: 3s\n          retries: <span class=\"token number\">3</span>\n\n    SERVICE_B:\n        build:\n          context: <span class=\"token builtin class-name\">.</span>\n          dockerfile: Dockerfile\n        image: SERVICE_B:7.1.0\n        container_name: SERVICE_B\n        restart: always\n        depends_on:\n          database:\n            condition: service_healthy\n        ports:\n          - <span class=\"token variable\">${SERVICE_B_PORT_IN}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">${SERVICE_B_PORT_OUT}</span>\n        environment:\n          NODENAME: <span class=\"token variable\">${SERVICE_B_NAME}</span>\n          DB_HOST: db_instance\n          DB_KIND: <span class=\"token variable\">${DB_KIND}</span>\n          DB_NAME: <span class=\"token variable\">${DB_NAME}</span>\n          DB_SCHEMA_NAME: <span class=\"token variable\">${DB_SCHEMA_NAME}</span>\n          DB_USER: <span class=\"token variable\">${DB_USER}</span>\n          DB_PASSWORD: <span class=\"token variable\">${DB_PASSWORD}</span>\n          DB_PORT: <span class=\"token variable\">${DB_PORT_OUT}</span>\n\n    SERVICE_D:\n        image: SERVICE_D:7.1.0\n        container_name: SERVICE_D\n        restart: always\n        depends_on:\n          database:\n              condition: service_healthy\n        ports:\n          - <span class=\"token variable\">${SERVICE_D_PORT_IN}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">${SERVICE_D_PORT_OUT}</span>\n          - <span class=\"token variable\">${SERVICE_D_CACHE_PORT_IN}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">${SERVICE_D_CACHE_PORT_OUT}</span>\n        environment:\n          NODENAME: <span class=\"token variable\">${SERVICE_D_NAME}</span>\n          DB_HOST: db_instance\n          DB_KIND: <span class=\"token variable\">${DB_KIND}</span>\n          DB_NAME: <span class=\"token variable\">${DB_NAME}</span>\n          DB_SCHEMA_NAME: <span class=\"token variable\">${DB_SCHEMA_NAME}</span>\n          DB_USER: <span class=\"token variable\">${DB_USER}</span>\n          DB_PASSWORD: <span class=\"token variable\">${DB_PASSWORD}</span>\n          DB_PORT: <span class=\"token variable\">${DB_PORT_OUT}</span>\n          SERVICE_B_IP: <span class=\"token variable\">${SERVICE_B_IP}</span>\nvolumes:\n  db_storage:\n    driver: <span class=\"token builtin class-name\">local</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># .env 파일은 그냥 실행해도 인식함</span>\n<span class=\"token comment\"># --force-recreate : 컨테이너를 삭제 후 재생성</span>\n<span class=\"token comment\"># docker compose up -d --force-recreate</span>\n\n<span class=\"token comment\"># .env 파일을 여러개 만들면 아래와 같이 실행</span>\ndocker-compose --env-file .\\.env.local up -d\n\n<span class=\"token comment\"># DB 컨테이너에서 스크립트 실행</span>\ndocker exec -it db_instance init\n\n<span class=\"token comment\"># 종료</span>\ndocker compose down -v</code></pre></div>\n</li>\n<li>\n<p>외부 DB를 연결하는 경우(docker-compose-external-db.yml)</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\">services:\n  SERVICE_B:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: SERVICE_B:7.1.0\n    container_name: SERVICE_B\n    restart: always\n    ports:\n      - ${SERVICE_B_PORT_IN}:${SERVICE_B_PORT_OUT}\n    environment:\n      NODENAME: ${SERVICE_B_NAME}\n      DB_HOST: ${DB_HOST}\n      DB_KIND: ${DB_KIND}\n      DB_NAME: ${DB_NAME}\n      DB_SCHEMA_NAME: ${DB_SCHEMA_NAME}\n      DB_USER: ${DB_USER}\n      DB_PASSWORD: ${DB_PASSWORD}\n      DB_PORT: ${DB_PORT_OUT}\n\n  SERVICE_D:\n    image: SERVICE_D:7.1.0\n    container_name: SERVICE_D\n    restart: always\n    ports:\n      - ${SERVICE_D_PORT_IN}:${SERVICE_D_PORT_OUT}\n      - ${SERVICE_D_CACHE_PORT_IN}:${SERVICE_D_CACHE_PORT_OUT}\n    environment:\n      NODENAME: ${SERVICE_D_NAME}\n      DB_HOST: ${DB_HOST}\n      DB_KIND: ${DB_KIND}\n      DB_NAME: ${DB_NAME}\n      DB_SCHEMA_NAME: ${DB_SCHEMA_NAME}\n      DB_USER: ${DB_USER}\n      DB_PASSWORD: ${DB_PASSWORD}\n      DB_PORT: ${DB_PORT_OUT}\n      SERVICE_B_IP: ${SERVICE_B_IP}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token comment\"># 19번 설정파일을 외부 DB에 연결하는 compose 명령어</span>\ndocker compose --env-file .\\.env.19 -f .\\docker-compose-external-db.yml up -d</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>종료하기</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># 종료 및 볼륨 삭제</span>\ndocker compose down <span class=\"token punctuation\">-</span>v</code></pre></div>\n</li>\n</ol>\n<h2 id=\"q--a\" style=\"position:relative;\"><a href=\"#q--a\" aria-label=\"q  a permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Q &#x26; A</h2>\n<details>\n    <summary>DB 컨테이너에서 다음과 같은 에러가 발생합니다 \n    psql: error: connection to server on socket \"/var/run/postgresql/.s.PGSQL.5432\" failed: No such file or directory</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">이 에러가 발생한 경우에는 PostgreSQL 서버가 실행되고 있지 않거나 서버에 접속할 수 있는 소켓 파일이 없기 때문일 수 있다.\n\n해결 방법으로는 다음과 같은 것들을 시도해 볼 수 있다:\n\n1. PostgreSQL 서버가 실행 중인지 확인하고, 실행 중이 아니라면 서버를 시작한다.\n    \n  ps aux | grep postgres\n    \n2. 소켓 파일이 없기 때문에 접속이 실패한 것일 수도 있으므로, 소켓 파일을 생성해준다.\n\n 소켓 파일을 생성하려면 **`pg_ctl`** 명령어를 사용할 수 있다. \n \n 예를 들어, 아래와 같이 입력할 수 있다:\n    \n  su postgres\n  \n  pg_ctl -w restart</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>볼륨을 여러곳에서 같이 쓰고 싶어요</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">volumes을 공유해서 사용할시 주의할 점은 공유할 볼륨의 이름을 컨테이너에 명시하는 것 뿐만 아니라 경로도 같아야 한다는 점이다.\n\nnodejs 컨테이너의 볼륨의 경로가 만약 아래처럼 변경된다면\n\n- shared-data:/test/nodejs\n\ndb 컨테이너의 볼륨의 경로도 아래처럼 바꿔줘야지만 같은 볼륨을 두 컨테이너에서 동시에 사용할 수 있다.\n\n- shared-data:/test/mysql</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>현재 상태를 이미지로 저장하고 싶어요</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 호스트 OS에서\ndocker commit -m \"메시지\" 컨테이너명 이미지명:태그</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>docker-compose vs docker compose, 무슨 차이인가요?</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose : 구버전, python 기반\n\ndocker compose : 신버전, Go언어 기반 + 신규 명령어 추가\n\n(실행 속도는 비슷하다.)</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>jar 파일 실행 시, Main Class를 찾을 수 없다는 에러가 발생합니다</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[참조글](https://chaelin1211.github.io/study/2021/03/12/springboot-error-01.html)\n\n- Spring boot를 사용하는 경우\n    \n  pom.xml에 아래 플러그인 추가\n    \n  &lt;plugin>\n      &lt;groupId>org.springframework.boot&lt;/groupId>\n      &lt;artifactId>spring-boot-maven-plugin&lt;/artifactId>\n  &lt;/plugin>\n    \n    \n- 순수 Java를 사용하는 경우\n    \n  jar 대신 war로 패키징하여 실행</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>특정 파일의 텍스트를 찾아 바꾸기 하고 싶어요</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># file.txt 파일에서 \"찾을내용\"을 \"바꿀내용\"으로 찾아바꾸기\n# 방법1\ntr '찾을내용' '바꿀내용' &lt; 바꿀파일\n\n# 방법2\n# -i : 파일의 내용을 바꿈\n# 's' : 찾아바꾸기\n# 'g' : 모든 문자열 바꾸기\nsed -i 's/찾을내용/바꿀내용/g' file.txt</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>도커 컨테이너의 캐시를 삭제하고 싶어요</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker system prune --volumes</code></pre></div>\n</details>\n<br>\n<details>\n    <summary>환경변수 값이 선택되는 우선순위는 뭔가요?(Compose / Dockerfile / Shell / Env)</summary>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. Compose 파일에 직접 입력한 값\n2. 쉘 환경변수로 등록한 값\n3. 환경변수 파일로 입력된 값(`.env` 등)\n4. Dockerfile을 통해 삽입된 값\n\n### **우선순위 결정 예시**\n\n우선, Dockerfile로 아래와 같이 `seongjin_mysql`이라는 이미지를 빌드했다고 가정하자.\nFROM mysql:8\nENV MYSQL_ROOT_PASSWORD passwd_from_dockerfile\n\n\n그리고 쉘 환경에서 아래와 같이 환경변수를 직접 입력한다.\n$ export MYSQL_ROOT_PASSWORD=passwd_from_shell\n\n\n다음으로는 `.env` 파일을 만들어 아래와 같이 환경변수를 설정했다고 치자.\nMYSQL_ROOT_PASSWORD=passwd_from_envfile\n\n\n마지막으로 배포용 `YAML`은 아래와 같이 작성했다고 가정한다.\nversion: '3.9'\nservices:\n  mysql:\n    image: seongjin_mysql\n    restart: unless-stopped\n    environment:\n      MYSQL_ROOT_PASSWORD: passwd_from_yaml\n\n\n이러한 환경에서 `docker compose up`을 실행했을 때, 해당 서비스(컨테이너)에 적용된 환경변수 `MYSQL_ROOT_PASSWORD`의 최종값을 상황 별로 알아보면 다음과 같다.\n\n- 위의 상태 그대로 진행했다면, `MYSQL_ROOT_PASSWORD`의 최종값은 `YAML`에 직접 삽입된 `passwd_from_yaml`이 된다.\n\n- 만약 `YAML`의 환경변수 항목이 `MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}`로 대체된다면, `MYSQL_ROOT_PASSWORD`의 최종값은 쉘에서 커맨드라인으로 입력된 `passwd_from_shell`이 된다.\n\n- 만약 `YAML`의 환경변수 항목이 `MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}`로 대체되고 쉘 환경에서의 환경변수 입력 과정이 생략된다면, `MYSQL_ROOT_PASSWORD`의 최종값은 `.env` 파일에 삽입된 `passwd_from_envfile`이 된다.\n\n- 만약 `YAML`에서 환경변수 항목이 완전히 삭제되고, 쉘 환경에서의 환경변수 입력 과정이 생략되며, `.env` 파일도 따로 만들어지지 않았다면, `MYSQL_ROOT_PASSWORD`의 최종값은 Dockerfile을 통해 삽입된 `passwd_from_dockerfile`이 된다.</code></pre></div>\n</details>\n<br>\n<hr>\n<br>\n<h2 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며..</h2>\n<p>이번 시간에는 컨테이너를 통해 실행환경 설정을 자동화해보았다.</p>\n<p>다음 시간에는 원격 저장소 release 브랜치에 push가 발생하면,</p>\n<p>docker 이미지로 CI/CD할 수 있도록 해보자</p>\n<hr>\n<br>\n<p><em>참고자료</em></p>\n<p><em><a href=\"https://docs.docker.com/compose/reference/\">Overview of docker compose CLI | Docker Documentation</a></em></p>\n<p><em><a href=\"https://1mini2.tistory.com/31\">[Docker-Basic (10)] Docker File 사용하기 - 실습2 MARIA DB (tistory.com)</a></em></p>\n<p><em><a href=\"https://www.daleseo.com/dockerfile/\">Dockerfile에서 자주 쓰이는 명령어 | Engineering Blog by Dale Seo</a></em></p>\n<p><em><a href=\"https://velog.io/@seheon99/%EC%B5%9C%EA%B3%A0%EC%9D%98-Dockerfile-%EC%9E%91%EC%84%B1%EC%9D%84-%EC%9C%84%ED%95%9C-%EB%AA%87-%EA%B0%80%EC%A7%80-%EC%8A%B5%EA%B4%80%EB%93%A4\">최고의 Dockerfile 작성을 위한 몇 가지 습관들 (velog.io)</a></em></p>\n<p><em><a href=\"https://narup.tistory.com/204\">[Dockerfile] Dockerfile이란? Dockerfile 옵션 — 시간이 멈추는 장소 (tistory.com)</a></em></p>\n<p><em><a href=\"https://mino-park7.github.io/docker/2018/12/10/dockerfile/\">Dockerfile 작성방법 및 읽는 법 · MinhoPark (mino-park7.github.io)</a></em></p>\n<p><em><a href=\"https://seongjin.me/environment-variables-in-docker-compose/\">Docker Compose에서 각 서비스 컨테이너에 쓰이는 환경변수를 다루는 방법 (seongjin.me)</a></em></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%9D%B4%EC%A0%84%ED%8E%B8-%EC%9A%94%EC%95%BD\">이전편 요약</a></li>\n<li><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></li>\n<li><a href=\"#%EC%97%AC%EC%A0%95\">여정</a></li>\n<li><a href=\"#q--a\">Q &#x26; A</a></li>\n<li><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\">마치며..</a></li>\n</ul>\n</div>","frontmatter":{"date":"December 25, 2022","title":"MSA 도커라이징(Dockerizing) 2편, 개선하기","categories":"infra","author":"주녁","emoji":"🔮"},"fields":{"slug":"/dockerize-msa-improve/"}},"site":{"siteMetadata":{"siteUrl":"https://www.junwork.net","comments":{"utterances":{"repo":"junwork123/blog-comments"}}}}},"pageContext":{"slug":"/dockerize-msa-basic/","nextSlug":"/about-TDD-and-CleanCode/","prevSlug":"/dockerize-msa-improve/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}