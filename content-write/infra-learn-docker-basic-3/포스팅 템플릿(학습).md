---
emoji: 🔮
title: Let’s Go Docker(심화편) - 변경사항을 Docker로 자동 배포하기
date: '2022-11-06 00:00:00'
author: 주녁
tags: 도커 Docker IntelliJ SpringBoot Docker VM Container 도커
categories: infra
---

지적과 댓글은 언제나 환영합니다!

<br/>

# 변경사항을 Docker로 자동 배포하기

변경사항을 감지하고 배포하려면

CI/CI 파이프라인 구축을 먼저 알아야한다.

<br>

---

# Github Action을 이용한 CI/CD

필자는 현재 이 블로그도 Github Action으로 배포하고 있다.

[블로그 빌드 및 배포 자동화

<br>

그 때의 [기억](https://www.junwork.net/blog-build-deploy-2/)을 되살려 빌드 스크립트를 재활용해보자.

```yaml
name: Blog Deployment # 이 스크립트의 제목

# 어떤 행동을 할때마다 실행할지
on:
  # master, release/v*라는 이름의 브랜치에 push가 발생할 때마다
  # ex) release/v0.1, release/v2.1.5
  push:
    branches:
      - master
      - release/v*

  # gh-pages 브랜치에 pull_request가 발생할 때마다
  pull_request:
    branches:
      - gh-pages

  # cron 표현식으로 `UTC 기준 매일 월~금 오전2시에 실행`
  schedule:
    - cron: '0 0 2 ? * MON-FRI *'

  # 직접 "Run workflow"버튼을 누를때만 실행
  workflow_dispatch:

# 실행할 작업을 정의
jobs:
  # 'build'라는 이름의 job은 (job이름은 맘대로 적어도 됨)
  # 'Checkout, Install, Build'라는 이름의 작업을
  # 우분투 최신버전에서 동작시킨다.
  # 동작내용은
  # [브랜치 체크아웃
  #   > 패키지 설치
  #   > 빌드
  #   > 메시지 출력
  #   > 도메인 복사
  #   > 배포] 순으로 진행된다.

  deploy:
    runs-on: ubuntu-latest

    name: Checkout, Install, Build

    # 다음 동작을 순서대로 실행
    steps:
      # 'uses' == 누군가 미리 정의된 workflow@version 사용
      # 'master' 브랜치를 체크아웃()
      - name: Checkout branche
        uses: actions/checkout@master

      # 패키지 설치 동작
      # [node 설치
      #   > 의존성 캐시검사
      #   > (변화가 있다면) npm설치] 순으로 동작
      - name: Use Node.js
        uses: actions/setup-node@master
        with:
          node-version: 16.x

      - name: Cache node modules
        uses: actions/cache@v2
        id: cache
        with:
          path: node_modules
          key: npm-packages-${{ hashFiles('**/package-lock.json') }}

      - name: Install Dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm install

      # 빌드 실행
      - name: Build
        run: npm run build

      # 도메인 설정파일을 빌드결과물에 복사
      - name: copy Cname
        run: cp CNAME public/

      # 특정 유저의 배포 액션을 이용하여
      # 빌드 결과물을 배포 경로에 복사한다.
      - name: Deploy changes
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages # default: gh-pages
```

---

<br>

_출처_

<br/>

---

```toc

```
